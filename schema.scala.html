@(results: String)

<html>
    <h1>AstriaGraph Schema</h1>

    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style type="text/css">
     .schema_diagram {
	 display:block;
	 width:100%;
	 height:100%;
	 border-style:solid;
	 border-width:2px;
	 border-color:black;
	 background-color:white;
     }

     html {
	 width:100%;
	 height:100%;
     }
     
    </style>

    <div id="instructions">
	<h3>Description</h3>
	This visualization shows the schema diagram of the AstriaGraph knowledge graph schema.
	<h4>Instructions to interact with visualization</h4>
	<em>*Our current implementation of the visualization is slow. We are working in updating it to improve its responsiveness. 
	     Please allow a few seconds per interactive action on the visualization</em>
	<ol>
	    <li>Single Clicking a node highlights that node and its neighbour nodes and their edges</li>
	    <li>Nodes not selected are grayed out</li>
	    <li>To reset all nodes and edges to their default color, click on a blank space</li>
	    <li>Multiple selected nodes (and neighbours) are highlighted in different colors</li> 
	    <ul><li>Any neighbour node common to two selection groups is highlight in the color of the most recent selection</li></ul>
	    <li>Any selected node can be clicked on again to change its highlighting color</li>
	    <ul><li>You may therefore keep clicking on a node until the highlighting color is to your preference. Ex. Contrasting well with other selection colors</li></ul>
	    <li>Right clicking certain nodes will show their description and approriate external reference url</li>
	</ol>
    </div>
    <br>

    <span style="background-color:#FFFF00">Data Source</span> <span style="background-color:#add8e6">
	Knowledge Field</span> <span style="background-color:#90ee90">Knowledge Class</span>
    <span style="background-color:#ffcccb">Problem</span>


    <div class="right_click_menu">
	<b id="heading"></b>
	<p id="description"></p>
	<a id="url"></a>
    </div>

    <div id="schema_diagram"></div>
</html>


<script>
 //load json data from template
 results_json= JSON.parse(@Html("`"+results+"`"));

 //Node descriptions and urls for specific nodes (to be shown when right clicked)
 special_node_descriptions_and_urls = {
     "DISCOS":{"description":
               "DISCOS (Database and Information System Characterising Objects in Space) serves as a single-source reference for launch information, object registration details, launch vehicle descriptions, as well as spacecraft information", "url":"https://discosweb.esoc.esa.int/"},
     "UN Registry":{"description":"UNO Space Objects Registry", "url":"https://www.unoosa.org/"},
     "GeoDisposalCompliance":{"description":"Querying space objects for geo-disposal compliance", "url":"http://astriaservices.tacc.utexas.edu/compliance"},
     "UnRegistryCompliance":{"description":"Querying space objects for UNO Registration compliance", "url":"http://astriaservices.tacc.utexas.edu/compliance"},
     "Visualization":{"description":"Visualization of Space Objects", "url":"http://astria.tacc.utexas.edu/AstriaGraph"},
 };

 //hide right click menu
 $(".right_click_menu").toggle();

 // create a network
 var container = document.getElementById("schema_diagram");

 //custom options for astriagraph liveschema
 var options = {
     height: getMapHeight()+"px", 
     width: getMapWidth()+"px",
     physics: {enabled:true, 
	       barnesHut: {
		   theta: 0.5,
		   gravitationalConstant: -5000,
		   centralGravity: 2,
		   springLength: 300,
		   springConstant: 0.01,
		   damping: 0.09,
		   avoidOverlap: 1
	       }, 
	       solver: 'barnesHut',
	       stabilization: {enabled: true,
			       iterations: 1000,
			       updateInterval: 100,
			       onlyDynamicEdges: false,
			       fit: true
	       },
	       wind:{x:7},
     }, 
     layout: {
	 //randomSeed: "0.9146962939741898:1623901278234",
	 //randomSeed: "0.8145072911746452:1623906161863",
	 //randomSeed: undefined,
	 randomSeed: "0.399907209554766:1623964197743",
	 //randomSeed:"0.399907209554766:1623964197743",
	 //randomSeed:"0.23331816166174812:1623962720173",
	 //randomSeed: "0.23331816166174812:1623962720173",
	 //randomSeed: "0.23331816166174812:1623962720173",
	 //randomSeed:"0.8188670540149801:1623962768442",
	 //randomSeed:"0.1490662722669338:1623960741232",
	 //randomSeed:"0.1986671577118675:1623962218684",
	 improvedLayout:true,
	 clusterThreshold: 150,
	 hierarchical: {
	     enabled:false,
	     levelSeparation: 80,
	     nodeSpacing: 500,
	     treeSpacing: 500,
	     blockShifting: true,
	     edgeMinimization: true,
	     parentCentralization: true,
	     direction: 'LR',        // UD, DU, LR, RL
	     sortMethod: 'hubsize',  // hubsize, directed
	     shakeTowards: 'roots'  // roots, leaves
	 }
     }, 
     edges: {
	 smooth: {
	     enabled: false,
	     type: "dynamic",
	     roundness: 0.5
	 }
     },
     nodes: {
	 borderWidth:1,
     },
     groups: {
	 Field:{color:"#add8e6", oldcolor:"#add8e6", font:{size:35}},
	 Problem:{color:"#ffcccb", oldcolor:"#ffcccb", font:{size:35}},
	 Class:{color:"#90ee90", oldcolor:"#90ee90", font:{size:35}},
	 Collection:{color:"#ffff00", oldcolor:"#ffff00", font:{size:35}}
     }
 };


// var mynetwork = document.getElementById("schema_diagram");

 var nodes = new vis.DataSet(results_json.nodes);
 var edges = new vis.DataSet(results_json.edges);

 allNodes = nodes.get({returnType:"Object"});
 allEdges = edges.get({returnType:"Object"});

 var currently_selected_edges = [];
 var currently_selected_nodes = [];

 //console.log(allEdges);
 var list_of_all_edges = Object.keys(allEdges).map(function(key){return key;});
 set_default_edge(list_of_all_edges);


 set_coordinates_for_collection_nodes();
 set_coordinates_for_problem_nodes();


 var data = {
     nodes: nodes,
     edges: edges,
 };

 var network = new vis.Network(container, data, options);

 //stop simulation after stabalization of network
 network.on("stabilizationIterationsDone", function () {
     network.setOptions( { physics: false } );
 });
 
  //sets up coordinate system to match canvas
 network.moveTo({
     position: {x: -getMapWidth()/2, y: -getMapHeight()/2},
     //offset: {x: -getMapWidth()/2, y: -getMapHeight()/2},
     scale: 1,
 });

 //add pop up menus for certain nodes containing urls for example website
 function add_url_popup(url, description) {
     const a = document.createElement("a");
     a.innerHTML = description;
     a.href=url;
     return a;
 }


 function add_hover_popups_for_nodes() {
     for(var [i, node] of Object.entries(allNodes)) {
         if(node.label == "Visualization") {
             url = "http://astria.tacc.utexas.edu/AstriaGraph/";
             description = "AstriaGraph: Space objects visualization";
             node.title = add_url_popup(url, description);
             node.x = network.getPosition(node.id).x;
             node.y = network.getPosition(node.id).y;
             nodes.update(node);
         }
         else if((node.label == "GeoDisposalCompliance") || (node.label == "UnRegistryCompliance")) {
             url = "http://astriaservices.tacc.utexas.edu/compliance";
             description = "Example Compliance Queries";
             node.title = add_url_popup(url, description);
             node.x = network.getPosition(node.id).x;
             node.y = network.getPosition(node.id).y;
             nodes.update(node);
         }
     }

 }

 add_hover_popups_for_nodes();


 network.on("click", node_select_handler);
 network.on("oncontext", node_right_click_handler);



</script>




</html>


